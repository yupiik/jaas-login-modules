= Login Modules
:minisite-index: 200
:minisite-index-title: Login Modules
:minisite-index-description: List of reusable login modules.
:minisite-index-icon: shield-alt

image::https://img.shields.io/maven-central/v/io.yupiik.jaas/jaas-login-modules?color=00b2ef&label=Last%20Release&logo=data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8%2BCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnODkwIgogICB4bWw6c3BhY2U9InByZXNlcnZlIgogICB3aWR0aD0iMjA0Ljc4Mjg1IgogICBoZWlnaHQ9IjI2Ny4zOTk5OSIKICAgdmlld0JveD0iMCAwIDIwNC43ODI4NiAyNjcuNCIKICAgc29kaXBvZGk6ZG9jbmFtZT0ieXVwaWlrLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4wLjEgKDNiYzJlODEzZjUsIDIwMjAtMDktMDcpIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE4OTYiPjxyZGY6UkRGPjxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8%2BPGRjOnRpdGxlPjwvZGM6dGl0bGU%2BPC9jYzpXb3JrPjwvcmRmOlJERj48L21ldGFkYXRhPjxkZWZzCiAgICAgaWQ9ImRlZnM4OTQiPjxjbGlwUGF0aAogICAgICAgY2xpcFBhdGhVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBpZD0iY2xpcFBhdGg5MDYiPjxwYXRoCiAgICAgICAgIGQ9Ik0gMCwxNjAwIEggMTYwMCBWIDAgSCAwIFoiCiAgICAgICAgIGlkPSJwYXRoOTA0IiAvPjwvY2xpcFBhdGg%2BPC9kZWZzPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMjUxMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMzc2IgogICAgIGlkPSJuYW1lZHZpZXc4OTIiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjAuMzc4ODU0NTciCiAgICAgaW5rc2NhcGU6Y3g9IjE0ODQuNTMxOSIKICAgICBpbmtzY2FwZTpjeT0iNDIyLjY0NDUzIgogICAgIGlua3NjYXBlOndpbmRvdy14PSI0OCIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMjciCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJnOTAyIgogICAgIGZpdC1tYXJnaW4tdG9wPSIwIgogICAgIGZpdC1tYXJnaW4tbGVmdD0iMCIKICAgICBmaXQtbWFyZ2luLXJpZ2h0PSIwIgogICAgIGZpdC1tYXJnaW4tYm90dG9tPSIwIiAvPjxnCiAgICAgaWQ9Imc4OTgiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpbmtzY2FwZTpsYWJlbD0iWXVwaWlrX2xvZ29fTUFTVEVSIgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMzMzMzMzMywwLDAsLTEuMzMzMzMzMywtNTc1LjExMSwxMjAwLjM2NjIpIj48ZwogICAgICAgaWQ9Imc5MDAiPjxnCiAgICAgICAgIGlkPSJnOTAyIgogICAgICAgICBjbGlwLXBhdGg9InVybCgjY2xpcFBhdGg5MDYpIj48ZwogICAgICAgICAgIGlkPSJnOTA4IgogICAgICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwOC4xMjcsNzQ5Ljk5MzcpIj48cGF0aAogICAgICAgICAgICAgZD0iTSAwLDAgLTMyLjg4OCwxNC4yNDMgMCw3MS4yMDkgMjguMTUsMjIuMTk4IDQxLjAyNSwyNy43NjUgOS4xOTEsODMuMTU1IEMgNy4yOTgsODYuNDMxIDMuNzc3LDg4LjQ2MSAwLDg4LjQ2MSBjIC0zLjc3NywwIC03LjI5OCwtMi4wMyAtOS4xOTIsLTUuMzA2IEwgLTQ1Ljc1OSwxOS44MTYgLTYxLjQ0NCwyNi42MDggMCwxMzMuMDI5IDYxLjQ0NSwyNi42MDggWiBNIDU0LjgxNSwtMjMuNzM0IDE3LjUyOSwtNy41OTIgMzkuOTA0LDIuMDk2IFogTSA3NS4zNzIsMzAuMzQ3IDkuMTkxLDE0NC45NzUgYyAtMS44OTMsMy4yNzYgLTUuNDE0LDUuMzA2IC05LjE5MSw1LjMwNiAtMy43NzcsMCAtNy4yOTgsLTIuMDMgLTkuMTg3LC01LjMwNiBMIC03NS4zNzcsMzAuMzQyIGMgLTEuNTA4LC0yLjYxOCAtMS44MjksLTUuNzY0IC0wLjg4MiwtOC42MzcgMC45NTIsLTIuODY5IDMuMDg2LC01LjIwNCA1Ljg1NiwtNi40MDYgTCAtMTcuNTMsLTcuNTkyIC01NC44MTYsLTIzLjczNCAtNDQuMjI1LC01LjI3NSAtNTcuMSwwLjI5MiAtNzEuOTA1LC0yNS40NjUgYyAtMi4yOTEsLTMuOTc4IC0xLjc4MSwtOC45NTIgMS4yNzMsLTEyLjM3NiAyLjA2MywtMi4zMTMgNC45NTgsLTMuNTQ4IDcuOTEzLC0zLjU0OCAxLjQyMSwwIDIuODU4LDAuMjg4IDQuMjI0LDAuODc2IGwgNTEuNTMyLDIyLjMxNCB2IC0yNS4xMDQgYyAwLC0zLjg0NyAzLjExNywtNi45NjYgNi45NjUsLTYuOTY2IDMuODQ4LDAgNi45NjcsMy4xMTkgNi45NjcsNi45NjYgdiAyNS4xMDIgbCA1MS41MiwtMjIuMzA3IGMgNC4yMTMsLTEuODI4IDkuMDg5LC0wLjc1NiAxMi4xNDIsMi42NjcgMy4wNTQsMy40MjQgMy41NjUsOC4zOTggMS4yNzQsMTIuMzc2IGwgLTE5LjEzLDMzLjEzMyAxNy42MjksNy42MzEgYyAyLjc2OSwxLjIwMiA0LjkwMiwzLjUzNyA1Ljg1NCw2LjQwNiAwLjk0OSwyLjg3MyAwLjYyNiw2LjAxOSAtMC44ODYsOC42NDIiCiAgICAgICAgICAgICBzdHlsZT0iZmlsbDojMDBiMmVmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICAgICAgaWQ9InBhdGg5MTAiIC8%2BPC9nPjxnCiAgICAgICAgICAgaWQ9Imc5MTIiCiAgICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzA0LjQwMzMsODUxLjgxNjkpIiAvPjxnCiAgICAgICAgICAgaWQ9Imc5MTYiCiAgICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODI0LjYwOTQsNzY5LjY1MDQpIiAvPjxnCiAgICAgICAgICAgaWQ9Imc5MjAiCiAgICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTUwLjQ3MTIsODA0LjU4MTUpIiAvPjxnCiAgICAgICAgICAgaWQ9Imc5MjgiCiAgICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTE0NC43NzgzLDg1MS44MTY5KSIgLz48L2c%2BPC9nPjwvZz48L3N2Zz4K&logoColor=00b2ef[]

TIP: to see sample configurations, read xref:sample-gallery.adoc[gallery samples] page.

== Maven Usage

To add `{artifactId}` to your project, use the following dependency:

[source,xml]
----
<dependency>
  <groupId>{groupId}</groupId>
  <artifactId>{artifactId}</artifactId>
  <version>${yupiik-loginmodules.version}</version>
</dependency>
----

TIP: you can select the version you want for `yupiik-loginmodules.version` at https://repo.maven.apache.org/maven2/io/yupiik/jaas/jaas-login-modules/ or check it at the top of this page.

== BaseLoginModule

This is an `abstract` class enabling to simplify the coding of a login module.

Usage:

[source,java]
----
public class MyLoginModule extends BaseLoginModule {
    @Override
    protected List<Principal> computePrincipals() {
        return /* compute principals */;
    }
}
----

Principals have access to the `options`/configuration of the login module through `parameters.options`.

== MatchingPrincipalLoginModule

This is another `abstract` class which reads options to find matchers and will call `computePrincipals()` method only if it matches, else the login module is ignored.

IMPORTANT: it is a matcher which is intended to be placed after another `LoginModule` since it will test existing `Principal` - computed by previous `LoginModules` to create its own ones.

IMPORTANT: the matching happens in `commit` hook and not `login` to ensure we can access subject principals.

Here are the matcher configuration - to set through `LoginModule` configuration:

[options="header",cols="1m,6,1m"]
|===
| Name | Description | Default
| matcher.allRequired | Boolean requiring that all matchers match, if `false` a single matching is sufficient to enable the login module principal computation. | false
| matcher.singleMatchingPrincipal | Boolean requiring that a single principal was matched thanks matchers (`isNumber`, `regex`, ...). | false
| matcher.hasName | An exact string which will be tested against principal names (faster than regex). | -
| matcher.regex | Java `Pattern`/regex at least one `Principal` of the current `Subject` should match - it means at least one of the previous `LoginModules` should have created a matching principal name. | -
| matcher.startsWith | A prefix a principal should have (faster than regex). | -
| matcher.endsWith | A prefix a principal should have (faster than regex). | -
| matcher.isNumber | Optimized flavor of the pattern matching for principals which should be numbers. | false
| matcher.count | Matches if the subject principal count is equal to the provided value | -
| matcher.isNumber.min | For `matcher.isNumber` rule, the minimum accepted number | -
| matcher.isNumber.max | For `matcher.isNumber` rule, the maximum accepted number | -
|===

== InterpolatingSinglePrincipalLoginModule

`InterpolatingSinglePrincipalLoginModule` is a `MatchingPrincipalLoginModule` which expects a single matching principal.
In such a case, it will use its rule to compute another principal from the matching one.

Common example is to deduce a group principal from the user name.

NOTE: it is a matching login module where `singleMatchingPrincipal` is forced to be `true`.

For example if only `the-user` is matching, then you can create with this login module the principal `group-the-user`.

Its configuration is:

[options="header",cols="1m,6"]
|===
| Name | Description
| interpolation.pattern | The principal value in case of matching, it can use `{name}` as a placeholder for the matching principal name.
| interpolation.principal.type | Class name of the principal if custom (`SimplePrincipal` is used otherwise)
|===

Sample usage:

[source,properties]
----
MyLoginModule {
    com.foo.MyAuthLoginModule required;
    io.yupiik.jaas.loginmodules.InterpolatingSinglePrincipalLoginModule optional
        matcher.regex="user_\p{Digit}"
        interpolation.pattern="group_{name}"
        interpolation.principal.type="org.apache.activemq.jaas.GroupPrincipal"
    ;
}
----

== ConditionalDelegatingLoginModule

This login module intent is to use a login module configured with `delegate.class` option
and only instantiated in `commit` phase when a matching (inherited from `MatchingPrincipalLoginModule`) is done.

== TypedPrincipalLoginModule

The sole purpose of this login module is to use another principal type for all principals computed by the underlying login module:

Its configuration is:

[options="header",cols="1m,6"]
|===
| Name | Description
| delegate.class | The login module type to delegate to (class name).
| delegate.configuration.xxx | Any configuration element of the `delegate.class` login module (prefix `delegate.configuraton.` is removed).
| interpolation.principal.type | Class name of the principal.
| removeWrapped | By default the wrapped principals are replaced but setting it to `false` will ust add the wrappers keeping original principals, this enables to keep the additional metadata if relevant by casting the principal.
|===

Sample usage:

[source,properties]
----
MyLoginModule {
    io.yupiik.jaas.loginmodules.TypedPrincipalLoginModule optional
        delegate.class="com.superbiz.jaas.MyLoginModuleCreatingAFooPrincipal"
        principal.type="org.apache.activemq.jaas.GroupPrincipal"
    ;
}
----

This configuration will use `org.apache.activemq.jaas.GroupPrincipal` for all principals added by `MyLoginModuleCreatingAFooPrincipal` in commit phase.
